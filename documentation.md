
# Pump Yourself server documentation


## Типы запросов к серверу

<Date> - строка в формате 'YYYY-MM-DDTHH:MM:SS'


## Запросы о еде

### Получение всей еды пользователя за период

Запрос: `GET /meal?action_id=0...`

Параметры запроса:

* user_id - Идентификатор пользователя
* start_date - Начальная дата периода (включительно)
* end_date - Конечная дата периода (включительно)

Тело ответа сервера:

```
{
    days: {
        <Date> : [{                 // ключ - дата приема пищи (YYYY-MM-DD)
            id: <Number>,           // Идентификатор факта приема пищи
            id_food: <Number>,      // является ключом в объекте dishes
            id_photo: <String>,     // является ключом в объекте photos
            date_time: <Date>,      // дата и время приема пищи (YYYY-MM-DDTHH:MM:SS)
            weight: <Number>,
        }, ...],
        ...
    },

    dishes: {
        <Number> : {            // ключ - id блюда
            name: <String>,
            proteins: <Number>,
            fats: <Number>,
            carbohydrates: <Number>,
            calories: <Number>
        },
        ...
    },

    photos: {
        <String> : <Buffer in JSON>,     // ключ - id фотографии, значение - фотография
        ...
    }
}
```

### Добавление факта приема пищи пользователем

Запрос: `POST /meal?action_id=1`

Тело запроса:

```
[
    <Number>,                       // Идентификатор пользователя
    <Date>,                         // Дата отправки запроса (YYYY-MM-DDTHH:MM:SS)
    {
        name: <String>,             // Название блюда
        weight: <Number>,           // Вес блюда
        photo: <Buffer in JSON>,    // Фотография блюда*
        proteins: <Number>,         // Количество грамм белков на 100 грамм блюда
        fats: <Number>,             // Количество грамм жиров на 100 грамм блюда
        carbohydrates: <Number>,    // Количество грамм углеводов на 100 грамм блюда
        calories: <Number>          // Количество калорий на 100 грамм блюда
    }
]
```

\* - Если было выбрано стандартное блюдо и оно не было изменено, фотография не присылается

Тело ответа сервера:
<Number> - Идентификатор факта приема пищи

### Редактирование факта приема пищи

Запрос: `POST /meal?action_id=2`

Тело запроса:

```
[
    <Number>,                       // Идентификатор пользователя
    <Number>,                       // Идентификатор факта приема пищи
    <Date>,                         // Дата отправки запроса (YYYY-MM-DDTHH:MM:SS)
    eating: {
        name: <String>,             // Название блюда
        weight: <Number>,           // Вес блюда
        photo: <Buffer in JSON>,    // Фотография блюда*
        proteins: <Number>,         // Количество грамм белков на 100 грамм блюда
        fats: <Number>,             // Количество грамм жиров на 100 грамм блюда
        carbohydrates: <Number>,    // Количество грамм углеводов на 100 грамм блюда
        calories: <Number>          // Количество калорий на 100 грамм блюда
    }
]
```

\* - Фотография присылается только в случае её изменения

Тело ответа сервера отсутствует

### Удаление факта приема пищи

Запрос: `POST /meal?action_id=3`

Тело запроса:

```
[ <Number> ] - Идентификатор факта приема пищи
```

Тело ответа сервера отсутствует


## Запросы о группах

### Получение всех групп пользователя

Запрос: `GET /groups?action_id=0...`

Параметры запроса:

* user_id - Идентификатор пользователя

Тело ответа сервера:

```
{
    <Number> : {                    // ключ - идентификатор пользователя-группы
        group_id: <Number>          // идентификатор группы
        name: <String>              // имя группы
        description: <String>       // описание группы
        photo: <Buffer in JSON>     // фотография группы
        members: 
        training: {                 // тренировка
            id: <Number>            // идентификатор тренировки
            name: <String>          // имя тренировки (не используется)
            description: <String>   // описание тренировки (не используется)
            days: [                 // план тренировки
                {
                    day_number: <Number>        // Номер дня
                    day_plan: <String>          // Описание тренировки в этот день
                },
                ...
            ]
        }
    },
    ...
}
```


## Запросы о пользователях

### Получение информации о профиле пользователя

Запрос: `GET /profile?action_id=0...`

Параметры запроса:

* user_id - Идентификатор пользователя

Тело ответа сервера:

```
{
    name: <String>                  // имя пользователя
    status: <String>                // статус пользователя
    photo: <Buffer in JSON>         // фотография пользователя
    notifications: {                // уведомления
        friends_requests: {         // запросы на добавление в друзья
            <Number>: {                         // идентификатор пользователя друга
                name: <String>                  // имя друга
                status: <String>                // статус друга
                photo: <Buffer in JSON>         // фотография друга
            },
            ...
        }
        groups_requests: {         // приглашения в группу
            <Number>: {                         // идентификатор группы
                name: <String>                  // имя группы
                description: <String>           // описание группы
                photo: <Buffer in JSON>         // фотография группы
            },
            ...
        }
    }
    friends: {                      // друзья
        <Number>: {                         // идентификатор пользователя друга
            name: <String>                  // имя друга
            status: <String>                // статус друга
            photo: <Buffer in JSON>         // фотография друга
        },
        ...
    }
}
```

### Получение дополнительной информации о профиле друга

Используется, когда необходимо подгрузить дополнительную информацию о профиле друга. Подразумевается, что имя пользователя, его статус и фотография уже известны.

Запрос: `GET /profile?action_id=1...`

Параметры запроса:

* user_id - Идентификатор пользователя, который посылает запрос
* friend_id - Идентификатор пользователя друга

Тело ответа сервера:

```
{
    friends: {                      // друзья друга
        <Number>: {                         // идентификатор пользователя друга
            name: <String>                  // имя друга
            status: <String>                // статус друга
            photo: <Buffer in JSON>         // фотография друга
        },
        ...
    }
    mutual_groups: {                // общие группы
        <Number>: {                         // идентификатор группы
            name: <String>                  // имя группы
            description: <String>           // описание группы
            photo: <Buffer in JSON>         // фотография группы
        },
        ...
    }
}
```

### Поиск пользователей по фразе

Используется во время поиска друзей. Производится поиск пользователей, имя которых включает в себя введенный текст.

Запрос: `GET /profile?action_id=2...`

Параметры запроса:

* phrase - Текст, по которому осуществляется поиск

Тело ответа сервера:

```
{
    <Number>: {                     // Идентификатор найденного пользователя
        name: <String>              // Имя пользователя
        status: <String>            // Статус пользователя
        photo: <Buffer in JSON>     // Фотография пользователя
    },
    ...
}
```

### Добавление нового пользователя

Запрос: `POST /profile?action_id=3`

Тело запроса:

```
[
    {
        login: <String>,            // Имя пользователя
        password: <String>,         // Статус пользователя
        name: <String>,             // Имя пользователя
        status: <String>,           // Статус пользователя
        photo: <Buffer in JSON>,    // Фотография пользователя*
    }
]
```

\* - Фотография может отсутствовать

Тело ответа сервера:
<Number> - Идентификатор нового пользователя

### Редактирование информации о пользователе

Подразумевает редактирование имени пользователя, статуса и фотографии

Запрос: `POST /profile?action_id=4`

Тело запроса:

```
[
    <Number>,                       // Идентификатор пользователя
    user_info: {
        name: <String>,             // Имя пользователя
        status: <String>,           // Статус пользователя
        photo: <Buffer in JSON>,    // Фотография пользователя*
    }
]
```

\* - Фотография присылается только в случае её изменения

Тело ответа сервера отсутствует


### Принятие/отклонение запроса в группу

Запрос: `POST /profile?action_id=5`

action_id=5 - для принятия запроса
action_id=6 - для отклонения запроса

Тело запроса:

```
[
    <Number>,           // Идентификатор пользователя
    <Number>            // Идентификатор группы
]
```

Тело ответа сервера:
<Number> - Идентификатор пользователя-группы (в случае принятия запроса)


### Принятие/отклонение запроса в друзья

Запрос: `POST /profile?action_id=7`

action_id=7 - для принятия запроса
action_id=8 - для отклонения запроса

Тело запроса:

```
[
    <Number>,           // Идентификатор пользователя
    <Number>            // Идентификатор пользователя друга
]
```

Тело ответа сервера отсутствует


### Отправка запроса в друзья

Запрос: `POST /profile?action_id=9`

Тело запроса:

```
[
    <Number>,           // Идентификатор пользователя
    <Number>            // Идентификатор пользователя друга
]
```

Тело ответа сервера отсутствует


### Удаление из друзей

Запрос: `POST /profile?action_id=10`

Тело запроса:

```
[
    <Number>,           // Идентификатор пользователя
    <Number>            // Идентификатор пользователя друга
]
```

Тело ответа сервера отсутствует