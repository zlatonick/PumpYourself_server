
# Pump Yourself server documentation


## Типы запросов к серверу

* [Запросы о еде](#запросы-о-еде)
* [Запросы о тренировках](#запросы-о-тренировках)
* [Запросы о группах](#запросы-о-группах)
* [Запросы о пользователях](#запросы-о-пользователях)

## Запросы о еде

### Получение всей еды пользователя за период

Запрос: `GET /meal?action_id=0...`

Параметры запроса:

* user_id - Идентификатор пользователя
* start_date - Начальная дата периода (включительно) (YYYY-MM-DD)
* end_date - Конечная дата периода (не включительно) (YYYY-MM-DD)

Тело ответа сервера:

```
{
    days: {
        <Date> : [{                 // ключ - дата приема пищи (YYYY-MM-DD)
            id: <Number>,           // Идентификатор факта приема пищи
            id_food: <Number>,      // является ключом в объекте dishes
            id_photo: <String>,     // является ключом в объекте photos
            date_time: <Date>,      // дата и время приема пищи (YYYY-MM-DDTHHMMSS)
            weight: <Number>,
        }, ...],
        ...
    },

    dishes: {
        <Number> : {            // ключ - id блюда
            name: <String>,
            proteins: <Number>,
            fats: <Number>,
            carbohydrates: <Number>,
            calories: <Number>
        },
        ...
    },

    photos: {
        <String> : <Buffer in JSON>,     // ключ - id фотографии, значение - фотография
        ...
    }
}
```

### Добавление факта приема пищи пользователем

Запрос: `POST /meal?action_id=1`

Тело запроса:

```
[
    <Number>,                       // Идентификатор пользователя
    <Date>,                         // Дата отправки запроса (YYYY-MM-DDTHHMMSS)
    {
        name: <String>,             // Название блюда
        weight: <Number>,           // Вес блюда
        photo: <Buffer in JSON>,    // Фотография блюда*
        proteins: <Number>,         // Количество грамм белков на 100 грамм блюда
        fats: <Number>,             // Количество грамм жиров на 100 грамм блюда
        carbohydrates: <Number>,    // Количество грамм углеводов на 100 грамм блюда
        calories: <Number>          // Количество калорий на 100 грамм блюда
    }
]
```

\* - Если было выбрано стандартное блюдо и оно не было изменено, фотография не присылается

Тело ответа сервера:
<Number> - Идентификатор факта приема пищи

### Редактирование факта приема пищи

Запрос: `POST /meal?action_id=2`

Тело запроса:

```
[
    <Number>,                       // Идентификатор пользователя
    <Number>,                       // Идентификатор факта приема пищи
    <Date>,                         // Дата отправки запроса (YYYY-MM-DDTHHMMSS)
    eating: {
        name: <String>,             // Название блюда
        weight: <Number>,           // Вес блюда
        photo: <Buffer in JSON>,    // Фотография блюда*
        proteins: <Number>,         // Количество грамм белков на 100 грамм блюда
        fats: <Number>,             // Количество грамм жиров на 100 грамм блюда
        carbohydrates: <Number>,    // Количество грамм углеводов на 100 грамм блюда
        calories: <Number>          // Количество калорий на 100 грамм блюда
    }
]
```

\* - Фотография присылается только в случае её изменения

Тело ответа сервера отсутствует

### Удаление факта приема пищи

Запрос: `POST /meal?action_id=3`

Тело запроса:

```
[ <Number> ] - Идентификатор факта приема пищи
```

Тело ответа сервера отсутствует


## Запросы о тренировках

### Получение всех тренировок пользователя

Запрос: `GET /trainings?action_id=0...`

Параметры запроса:

* user_id - Идентификатор пользователя

Тело ответа сервера:

```
{
    <Number> : {                    // ключ - идентификатор тренировки
        name: <String>              // имя тренировки
        description: <String>       // описание тренировки
        start_date: <Date>          // дата начала тренировки (YYYY-MM-DD)
        days: [                     // план тренировки
            {
                day_number: <Number>        // Номер дня
                day_plan: <String>          // Описание тренировки в этот день
            },
            ...
        ]
    },
    ...
}
```

### Получение всех публичных тренировок

Запрос: `GET /trainings?action_id=1`

Параметры запроса отсутствуют

Тело ответа сервера:

```
{
    <Number> : {                    // ключ - идентификатор тренировки
        name: <String>              // имя тренировки
        description: <String>       // описание тренировки
        days: [                     // план тренировки
            {
                day_number: <Number>        // Номер дня
                day_plan: <String>          // Описание тренировки в этот день
            },
            ...
        ]
    },
    ...
}
```

### Создание тренировки

Пользователь автоматически НЕ подписывается на созданную тренировку

Запрос: `POST /trainings?action_id=2`

Тело запроса:

```
[
    {
        name: <String>              // имя тренировки
        description: <String>       // описание тренировки
        days: [                     // план тренировки
            {
                day_number: <Number>        // Номер дня
                day_plan: <String>          // Описание тренировки в этот день
            },
            ...
        ]
    }    
]
```

Тело ответа сервера:
<Number> - Идентификатор новой тренировки


### Подписка на тренировку

Запрос: `POST /trainings?action_id=3`

Тело запроса:

```
[
    <Number>,                   // Идентификатор пользователя
    <Number>,                   // Идентификатор тренировки
    <Date>                      // Дата начала тренировки (YYYY-MM-DD)
]
```

Тело ответа сервера отсутствует


### Отписка от тренировки

Запрос: `POST /trainings?action_id=4`

Тело запроса:

```
[
    <Number>,                   // Идентификатор пользователя
    <Number>,                   // Идентификатор тренировки
]
```

Тело ответа сервера отсутствует


## Запросы о группах

### Получение всех групп пользователя

Выдается только поверхностная информация о группах

Запрос: `GET /groups?action_id=0...`

Параметры запроса:

* user_id - Идентификатор пользователя

Тело ответа сервера:

```
{
    <Number> : {                    // ключ - идентификатор группы
        name: <String>              // имя группы
        description: <String>       // описание группы
        photo: <Buffer in JSON>     // фотография группы
    },
    ...
}
```

### Получение подробной информации о группе

Используется, когда поверхностная информация о группе уже известна и необходимо подгрузить дополнительные данные (члены группы и информаци о тренировке)

Запрос: `GET /groups?action_id=1...`

Параметры запроса:

* group_id - Идентификатор группы

Тело ответа сервера:

```
{
    members: {                  // члены группы
        <Number>: {                     // Идентификатор пользователя
            user_name: <String>         // Имя пользователя
            photo: <Buffer in JSON>     // Фотография пользователя
        },
        ...
    }

    training: {                 // тренировка
        training_id: <Number>   // идентификатор тренировки
        start_date: <Date>      // дата начала тренировки (YYYY-MM-DD)
        days: [                 // план тренировки
            {
                day_number: <Number>        // Номер дня
                day_plan: <String>          // Описание тренировки в этот день
            },
            ...
        ]
    }
}
```

### Создание группы

Запрос необходимо отправлять после создания тренировки. Пользователь автоматически вступает в созданную группу

Запрос: `POST /groups?action_id=2`

Тело запроса:

```
[
    <Number>                // Идентификатор пользователя
    {
        name: <String>,             // Имя группы
        description: <String>,      // Описание группы
        photo: <Buffer in JSON>,    // Фотография группы*
        training_id: <Number>       // Идентификатор тренировки
        start_date: <Date>          // дата начала тренировки (YYYY-MM-DD)
    }
]
```

\* - Фотография может отсутствовать

Тело ответа сервера:
<Number> - Идентификатор новой группы


### Редактирование группы

Запрос: `POST /groups?action_id=3`

Тело запроса:

```
[
    <Number>                // Идентификатор группы
    {
        name: <String>,             // Имя группы
        description: <String>,      // Описание группы
        photo: <Buffer in JSON>,    // Фотография группы*
    }
]
```

\* - Фотография может отсутствовать

Тело ответа сервера отсутствует


### Приглашение друга в группу

Запрос: `POST /groups?action_id=4`

Тело запроса:

```
[
    <Number>,               // Идентификатор пользователя
    <Number>,               // Идентификатор друга
    <Number>                // Идентификатор группы    
]
```

Тело ответа сервера отсутствует


### Выход из группы

Запрос: `POST /groups?action_id=5`

Тело запроса:

```
[
    <Number>,               // Идентификатор пользователя
    <Number>                // Идентификатор группы    
]
```

Тело ответа сервера отсутствует


## Запросы о пользователях

### Получение информации о профиле пользователя

Запрос: `GET /profile?action_id=0...`

Параметры запроса:

* user_id - Идентификатор пользователя

Тело ответа сервера:

```
{
    name: <String>                  // имя пользователя
    status: <String>                // статус пользователя
    photo: <Buffer in JSON>         // фотография пользователя
    notifications: {                // уведомления
        friends_requests: {         // запросы на добавление в друзья
            <Number>: {                         // идентификатор пользователя друга
                name: <String>                  // имя друга
                status: <String>                // статус друга
                photo: <Buffer in JSON>         // фотография друга
            },
            ...
        }
        groups_requests: {         // приглашения в группу
            <Number>: {                         // идентификатор группы
                name: <String>                  // имя группы
                description: <String>           // описание группы
                photo: <Buffer in JSON>         // фотография группы
            },
            ...
        }
    }
    friends: {                      // друзья
        <Number>: {                         // идентификатор пользователя друга
            name: <String>                  // имя друга
            status: <String>                // статус друга
            photo: <Buffer in JSON>         // фотография друга
        },
        ...
    }
}
```

### Получение дополнительной информации о профиле друга

Используется, когда необходимо подгрузить дополнительную информацию о профиле друга. Подразумевается, что имя пользователя, его статус и фотография уже известны.

Запрос: `GET /profile?action_id=1...`

Параметры запроса:

* user_id - Идентификатор пользователя, который посылает запрос
* friend_id - Идентификатор пользователя друга

Тело ответа сервера:

```
{
    friends: {                      // друзья друга
        <Number>: {                         // идентификатор пользователя друга
            name: <String>                  // имя друга
            status: <String>                // статус друга
            photo: <Buffer in JSON>         // фотография друга
        },
        ...
    }
    mutual_groups: {                // общие группы
        <Number>: {                         // идентификатор группы
            name: <String>                  // имя группы
            description: <String>           // описание группы
            photo: <Buffer in JSON>         // фотография группы
        },
        ...
    }
}
```

### Поиск пользователей по фразе

Используется во время поиска друзей. Производится поиск пользователей, имя которых включает в себя введенный текст.

Запрос: `GET /profile?action_id=2...`

Параметры запроса:

* phrase - Текст, по которому осуществляется поиск

Тело ответа сервера:

```
{
    <Number>: {                     // Идентификатор найденного пользователя
        name: <String>              // Имя пользователя
        status: <String>            // Статус пользователя
        photo: <Buffer in JSON>     // Фотография пользователя
    },
    ...
}
```

### Добавление нового пользователя

Запрос: `POST /profile?action_id=3`

Тело запроса:

```
[
    {
        login: <String>,            // Имя пользователя
        password: <String>,         // Статус пользователя
        name: <String>,             // Имя пользователя
        status: <String>,           // Статус пользователя
        photo: <Buffer in JSON>,    // Фотография пользователя*
    }
]
```

\* - Фотография может отсутствовать

Тело ответа сервера:
<Number> - Идентификатор нового пользователя

### Редактирование информации о пользователе

Подразумевает редактирование имени пользователя, статуса и фотографии

Запрос: `POST /profile?action_id=4`

Тело запроса:

```
[
    <Number>,                       // Идентификатор пользователя
    {
        name: <String>,             // Имя пользователя
        status: <String>,           // Статус пользователя
        photo: <Buffer in JSON>,    // Фотография пользователя*
    }
]
```

\* - Фотография присылается только в случае её изменения

Тело ответа сервера отсутствует


### Принятие/отклонение запроса в группу

Запрос: `POST /profile?action_id=5`

action_id=5 - для принятия запроса
action_id=6 - для отклонения запроса

Тело запроса:

```
[
    <Number>,           // Идентификатор пользователя
    <Number>            // Идентификатор группы
]
```

Тело ответа сервера отсутствует


### Принятие/отклонение запроса в друзья

Запрос: `POST /profile?action_id=7`

action_id=7 - для принятия запроса
action_id=8 - для отклонения запроса

Тело запроса:

```
[
    <Number>,           // Идентификатор пользователя
    <Number>            // Идентификатор пользователя друга
]
```

Тело ответа сервера отсутствует


### Отправка запроса в друзья

Запрос: `POST /profile?action_id=9`

Тело запроса:

```
[
    <Number>,           // Идентификатор пользователя
    <Number>            // Идентификатор пользователя друга
]
```

Тело ответа сервера отсутствует


### Удаление из друзей

Запрос: `POST /profile?action_id=10`

Тело запроса:

```
[
    <Number>,           // Идентификатор пользователя
    <Number>            // Идентификатор пользователя друга
]
```

Тело ответа сервера отсутствует


### Вход в аккаунт

Запрос: `GET /profile?action_id=11...`

Параметры запроса:

* login - логин
* password - пароль

Тело ответа сервера:

```
[
    <Number>,           // Идентификатор пользователя*
]
```

\* - В случае неудачной аутентификации возвращается значение -1
